---
title: C# | WPF Prism DataGrid Columnã®Visibilityã‚’ãƒã‚¤ãƒ³ãƒ‰
description: C# WPF Prism ã§ DataGrido ã‚«ãƒ©ãƒ ã® Visibility ã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹æ–¹æ³•
date: 2023-02-27
emoji: ğŸ”©
tags: 
  - csharp
published: true
---

C#ã® **WPF Prism** ã§DataGridoã‚«ãƒ©ãƒ ã®Visibilityã‚’ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

ä¾‹ãˆã°ã€DataGridå†…ã®ã‚«ãƒ©ãƒ ã«å¯¾ã—ã¦ã‚³ãƒ³ãƒœãƒœãƒƒã‚¯ã‚¹ï¼ˆã®é¸æŠè‚¢ï¼‰ã‚’ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰ã•ã›ã‚‹å ´åˆã€RelativeSource FindAncestor ã‚’ç”¨ã„ãŸæ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚  
ã—ã‹ã—ã€**DataGridã®ã‚«ãƒ©ãƒ ã®Visibilityã«ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹å ´åˆã€RelativeSourceã‚’ç”¨ã„ãŸæ–¹æ³•ã¯ä½¿ãˆã¾ã›ã‚“**ã€‚

ãã®ãŸã‚ã€ViewModelã‚’å‚ç…§å¯èƒ½ã¨ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¦å¯¾å¿œã—ã¾ã™ã€‚


## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼‰

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸‹è¨˜ã® **Aï½C** ã§ã™ã€‚

```text
WPF/
 |-Services/
 |  |-BindingProxy.cs ï½¥ï½¥ï½¥A
 |
 |-Views/
 |  |-SampleView.xaml ï½¥ï½¥ï½¥B  
 |
 |-ViewModels/
 |  |-SampleViewModel.cs ï½¥ï½¥ï½¥C  
```

## BindingProxy.csã€€ï½¥ï½¥ï½¥A

é€šå¸¸ã€ItemsSourceã‚’ä½¿ã†ã¨ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã„ã‚‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®å„è¦ç´ ãŒDataContextã¨ãªã‚‹ãŸã‚ã€
DataGridå†…ã§ã¯ItemsSourceä»¥å¤–ã®ãƒã‚¤ãƒ³ãƒ‰ãŒå‡ºæ¥ãªããªã‚Šã¾ã™ã€‚

â€»DataContextï¼šBindingã®å¯¾è±¡

ãã“ã§ã€DataGridå†…ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç›´æ¥ViewModelã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ã™ã‚‹**ã€ŒBindingProxyã€**ã‚¯ãƒ©ã‚¹ã‚’æº–å‚™ã—ã¾ã™ã€‚

â–¼BindingProxy.cs

```cs
using System.Windows;

namespace Template2.WPF.Services
{
    /// <summary>
    /// ViewModelã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚½ãƒ¼ã‚¹ã®ä»£ç†ã¨ã—ã¦åƒãã‚¯ãƒ©ã‚¹ã§ã™ã€‚
    /// </summary>
    public class BindingProxy : Freezable
    {
        /// <summary>
        /// Freezableã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
        /// </summary>
        /// <returns></returns>
        protected override Freezable CreateInstanceCore()
        {
            return new BindingProxy();
        }

        /// <summary>
        /// é–“ã‚’ã¨ã‚Šã‚‚ã¤ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
        /// ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰ã—ãŸå ´åˆã¯ã€ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒViewModelã®ä»£ã‚ã‚Šã«ãªã‚‹ã€‚
        /// </summary>
        public object Data
        {
            get { return (object)GetValue(DataProperty); }
            set { SetValue(DataProperty, value); }
        }

        /// <summary>
        /// Data ã®ä¾å­˜é–¢ä¿‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®šç¾©
        /// </summary>
        public static readonly DependencyProperty DataProperty =
            DependencyProperty.Register("Data", typeof(object), typeof(BindingProxy), new UIPropertyMetadata(null));
    }
}
```

## SampleView.xaml ï½¥ï½¥ï½¥B  

### â‘ Viewã®xamlã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚¯ãƒ©ã‚¹å‚ç…§ã‚’è¿½åŠ 

Windowã‚‚ã—ãã¯UserControlè¦ç´ ã«ã€BindingProxyã‚¯ãƒ©ã‚¹ã®namespaceå‚ç…§ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ä¾‹ï¼‰BindingProxy.cs ã® namespace ãŒã€Template2.WPF.Services ã®å ´åˆ  
**`xmlns:services="clr-namespace:Template2.WPF.Services"`**

â–¼SampleView.xaml
```xml
<UserControl x:Class="Template2.WPF.Views.Sample002View"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"             
             prism:ViewModelLocator.AutoWireViewModel="True"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             Background="{StaticResource backgroundColor}"
             xmlns:services="clr-namespace:Template2.WPF.Services"
             >
```

### â‘¡DataGridã®ãƒªã‚½ãƒ¼ã‚¹ã«BindingProxyå‚ç…§ã‚’è¿½åŠ 

ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦DataGridå†…ã§BindingProxyã‚’åˆ©ç”¨å¯èƒ½ã¨ã—ã¾ã™ã€‚

```xml
<DataGrid.Resources>
    <!--DataGridã®ItemSourceã¨ã¯åˆ¥ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’Bindã™ã‚‹ãŸã‚ã«å¿…è¦-->
    <services:BindingProxy x:Key="Proxy" Data="{Binding}"/>
</DataGrid.Resources>
```

ä¾‹ï¼‰DataGridã¸ã®çµ„è¾¼ã¿ä¾‹

â–¼SampleView.xaml
```xml
<DataGrid Style="{StaticResource commonDataGrid}"
          ItemsSource="{Binding WorkerMstEntities}"
          SelectedItem="{Binding WorkerMstEntitiesSlectedItem}"
          VerticalAlignment="Top"
          HorizontalAlignment="Left"
          IsReadOnly="False"
          CanUserAddRows="False"
          Cursor="Hand">

                <DataGrid.Resources>
                    <!--DataGridã®ItemSourceã¨ã¯åˆ¥ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’Bindã™ã‚‹ãŸã‚ã«å¿…è¦-->
                    <services:BindingProxy x:Key="Proxy" Data="{Binding}"/>
                </DataGrid.Resources>

                ï¼ˆçœç•¥ï¼‰
```

### â‘¢DataGridã‚«ãƒ©ãƒ ã®Visibilityã‚’ãƒã‚¤ãƒ³ãƒ‰

DataGridã®Columnè¦ç´ ã«ã€Visibilityã‚’è¿½åŠ ã—ã¾ã™ã€‚

**ãƒã‚¤ãƒ³ãƒˆ**
- Binding:Data.XXX ã‚’è¨˜è¼‰ã™ã‚‹ã“ã¨
- Source:StaticResourceã‚’è¨˜è¼‰ã™ã‚‹ã“ã¨

â–¼SampleView.xaml
```xml
<DataGrid.Columns>
    <!-- ã‚«ãƒ©ãƒ ã®Visibilityã¯ã€BindingProxyã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã—ã¦ViewModelã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã™ã‚‹å¿…è¦æœ‰ã‚Š -->
    <materialDesign:DataGridTextColumn Header="ä½œæ¥­è€…åç§°"
           Binding="{Binding WorkerName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
           Visibility="{Binding Data.WorkerNameVisibility, Source={StaticResource Proxy}}">

    ï¼ˆçœç•¥ï¼‰
```

## SampleViewModel.cs ï½¥ï½¥ï½¥C    

### â‘£ViewModelã«Visibilityãƒã‚¤ãƒ³ãƒ‰ç”¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æº–å‚™

é€šå¸¸ã®WPF Prismã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹æ–¹æ³•ã¨åŒæ§˜ã«ã€Visibilityã‚’ãƒã‚¤ãƒ³ãƒ‰ã—ãŸåç§°ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

â–¼SampleViewModel.cs
```cs
private Visibility _workerNameVisibility = Visibility.Visible;
public Visibility WorkerNameVisibility
{
    get { return _workerNameVisibility; }
    set { SetProperty(ref _workerNameVisibility, value); }
}
```

ä»¥ä¸Šã§ã™ã€‚
