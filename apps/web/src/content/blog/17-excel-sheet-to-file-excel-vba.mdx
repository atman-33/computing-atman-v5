---
title: VBA | Excelã®å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¦åˆ†å‰²ä¿å­˜
description: Excel VBA ã§ å„ã‚·ãƒ¼ãƒˆã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–¹æ³•
date: 2020-03-15
emoji: ğŸ†
tags: 
  - vba
published: true
---

Excelã§ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãªã©ä½œæˆã—ã¦ã„ã‚‹ã¨ã€ã‚·ãƒ¼ãƒˆæ•°ãŒå¤šããªã‚Šã™ãã¦ãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ãŒé‡ããªã£ãŸã‚Šã€Excelã®å‹•ä½œãŒé‡ããªã£ãŸã‚Šã™ã‚‹ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ãã®ã‚ˆã†ãªå ´åˆã«ä½¿ãˆãã†ãªã€Excelã®å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¦åˆ†å‰²ä¿å­˜ã™ã‚‹ãƒã‚¯ãƒ­ã‚’ä½œæˆã—ã¾ã—ãŸã®ã§èª¬æ˜ã—ã¾ã™ã€‚

[ã‚µãƒ³ãƒ—ãƒ«ã®Excelã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://github.com/atman-33/template-excel-vba/tree/main/Excel%E3%82%B7%E3%83%BC%E3%83%88%E3%82%92%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E5%88%87%E3%82%8A%E5%87%BA%E3%81%97%E5%87%BA%E5%8A%9B)


## æ¦‚è¦
ä»Šå›ã®ãƒã‚¯ãƒ­æ©Ÿèƒ½ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- ãƒã‚¯ãƒ­ã‚’å®Ÿè¡Œï¼ˆãƒœã‚¿ãƒ³æŠ¼ä¸‹ï¼‰
- å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ãŸã„Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
- é¸æŠãƒ•ã‚¡ã‚¤ãƒ«ã®å„ã‚·ãƒ¼ãƒˆã‚’Excelãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ä¿å­˜
ï¼ˆé¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒãƒ•ã‚©ãƒ«ãƒ€å†…ï¼‰
- ãƒã‚¯ãƒ­å®Ÿè¡ŒExcelãƒ•ã‚¡ã‚¤ãƒ«ã«ã€åˆ‡ã‚Šå‡ºã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ³ã‚¯å…ˆä¸€è¦§ã€ã‚’ç”Ÿæˆ

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ
Excelãƒã‚¯ãƒ­å†…ã®æ§‹æˆã¯ä¸‹è¨˜ã¨ãªã‚Šã¾ã™ ã€‚

```text
Excelã®å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—.xlsm
|
æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
|-Main
|-ModuleHelper
|-ModuleSheetToFile
```

## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰è§£èª¬
Excelã®VBAã€ã„ã‚ã‚†ã‚‹ãƒã‚¯ãƒ­å‡¦ç†ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚

### â‘ Main
```vb
Option Explicit

' ãƒ¡ã‚¤ãƒ³å‡¦ç†
Public Sub Main()

    ' æç”»å‡¦ç†ã€è‡ªå‹•æ›´æ–°ãªã©ã‚’åœæ­¢
    Focus True

    ' Excelã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å‡¦ç†
    GetOpenFileSheetstSave

    ' æç”»å‡¦ç†ã€è‡ªå‹•æ›´æ–°ãªã©ã‚’å†é–‹
    Focus False

End Sub
```
ãƒ¡ã‚¤ãƒ³ã® GetOpenFileSheetsSave é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹é–“ã« Focus é–¢æ•°ã‚’æº–å‚™ã—ã¾ã—ãŸã€‚


ã“ã® Focus é–¢æ•°ã§Excelã®æç”»å‡¦ç†ã€è‡ªå‹•æ›´æ–°ãªã©ã‚’åœæ­¢ã—ã¦ãŠãã“ã¨ã§ãƒã‚¯ãƒ­å®Ÿè¡Œæ™‚é–“ã‚’çŸ­ç¸®ã•ã›ã¾ã™ã€‚

___
### â‘ ModuleHelper

ä»Šå›ä½¿ç”¨ã™ã‚‹é–¢æ•°ã§ã™ã€‚

```vb
Option Explicit

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : ç”»é¢æç”»ãªã©ã‚’åœæ­¢ã—ã¦å®Ÿè¡Œã‚’æ—©ãã™ã‚‹ã€‚
' note  : Focus = True  -> æç”»åœæ­¢ã€ã‚¤ãƒ™ãƒ³ãƒˆæŠ‘åˆ¶ã€æ‰‹å‹•è¨ˆç®—
'         Focus = False -> æç”»å†é–‹ã€ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–å†é–‹ã€è‡ªå‹•è¨ˆç®—
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Public Sub Focus(ByVal Flag As Boolean)
    With Application
        .EnableEvents = Not Flag
        .ScreenUpdating = Not Flag
        .Calculation = IIf(Flag, xlCalculationManual, xlCalculationAutomatic)
    End With
End Sub
```

___
### â‘¡ModuleSheetToFile
ãƒã‚¤ãƒ³ãƒˆã‚„è£œè¶³ã¯ã‚³ãƒ¼ãƒ‰å†…ã®ã‚³ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚

```vb
Option Explicit

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : é¸æŠã—ãŸExcelãƒ•ã‚¡ã‚¤ãƒ«ã®å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—
' note  :
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Public Sub GetOpenFileSheetstSave()

    Dim openFilePath As String
    Dim saveFolderPath As String

    openFilePath = Application.GetOpenFilename(FileFilter:="Excelãƒ•ã‚¡ã‚¤ãƒ«,*.xlsx")

    If openFilePath <> "False" Then

        ' ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸå ´åˆ
        saveFolderPath = GetFileFolderPath(openFilePath)
        SheetsSave openFilePath, saveFolderPath

        MsgBox "å‡¦ç†ã‚’å®Œäº†ã—ã¾ã—ãŸ"
    Else
        MsgBox "ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ"
    End If

End Sub


' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : å„ã‚·ãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—
' note  : å¼•æ•°ã® excelPath, saveFolder ã¯ãƒ•ãƒ«ãƒ‘ã‚¹
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Public Sub SheetsSave(excelPath As String, saveFolderPath As String)

    Dim wb As Workbook
    Dim sheet As Object

    Dim linkListSheetRow As Long
    Dim linkListSheetName As String

    linkListSheetRow = 1
    linkListSheetName = "__LinkList__"

    ' ãƒ•ã‚¡ã‚¤ãƒ«åˆ‡ã‚Šå‡ºã—å…ˆãƒªãƒ³ã‚¯ä¸€è¦§ã®ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
    CreateSheet linkListSheetName

    ' ãƒ–ãƒƒã‚¯ã‚’é–‹ã
    Set wb = Workbooks.Open(excelPath)

    For Each sheet In wb.Worksheets

        ' äº‹å‰ã«åŒåã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
        KillFile saveFolderPath & "\" & sheet.name & ".xlsx"

        sheet.Copy
        ActiveWorkbook.SaveAs saveFolderPath & "\" & sheet.name
        ActiveWorkbook.Close

        ' ãƒ•ã‚¡ã‚¤ãƒ«åˆ‡ã‚Šå‡ºã—å…ˆãƒªãƒ³ã‚¯ä¸€è¦§ã¸è¿½åŠ 
        ThisWorkbook.Worksheets(linkListSheetName).Cells(linkListSheetRow, 1).Value = sheet.name
        ThisWorkbook.Worksheets(linkListSheetName).Cells(linkListSheetRow, 2).Value = saveFolderPath & "\" & sheet.name & ".xlsx"

        ' ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯è¿½åŠ ï¼ˆå¯¾è±¡ã®ã‚·ãƒ¼ãƒˆã‚’Activeã«ã™ã‚‹å¿…è¦ã‚ã‚Šï¼‰
        ThisWorkbook.Worksheets(linkListSheetName).Activate
        ActiveSheet.Hyperlinks.Add Anchor:=Cells(linkListSheetRow, 2), Address:=Cells(linkListSheetRow, 2).Value

        linkListSheetRow = linkListSheetRow + 1

    Next sheet

    ' ãƒ–ãƒƒã‚¯ã‚’é–‰ã˜ã‚‹
    Application.DisplayAlerts = False   'ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã•ãªã„
    wb.Close savechanges:=False         'ä¿å­˜ã›ãšã«é–‰ã˜ã‚‹
    Application.DisplayAlerts = True    'ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã™

End Sub

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ä½œæˆ
' note  : ä½œæˆã™ã‚‹ã‚·ãƒ¼ãƒˆã¯æœ€å¾Œå°¾ã«è¿½åŠ 
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Private Sub CreateSheet(sheetName As String)

    If SheetExists(sheetName) = False Then

        ThisWorkbook.Worksheets.Add after:=ThisWorkbook.Worksheets(ThisWorkbook.Worksheets.Count)
        ActiveSheet.name = sheetName

    End If

End Sub

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ‘ã‚¹ã‚’å–å¾—
' note  :
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Private Function GetFileFolderPath(filePath As String) As String

    Dim pathName As String
    Dim fileName As String

    fileName = Dir(filePath)
    pathName = Replace(filePath, fileName, "")
    pathName = CutRight(pathName, 1)
    Debug.Print pathName & vbCrLf & fileName

    GetFileFolderPath = pathName

End Function

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : æ–‡å­—åˆ—ã®å³å´ã‹ã‚‰æŒ‡å®šæ–‡å­—æ•°å‰Šé™¤
' note  : å¼•æ•°ï¼‘ï¼šå¯¾è±¡ã®æ–‡å­—åˆ—ã€å¼•æ•°ï¼’ï¼šå‰Šé™¤æ–‡å­—æ•°ã€æˆ»ã‚Šå€¤ï¼šå‰Šé™¤å¾Œã®æ–‡å­—åˆ—
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Private Function CutRight(s, i As Long) As String
    Dim iLen    As Long     ' æ–‡å­—åˆ—é•·

    ' æ–‡å­—åˆ—ã§ã¯ãªã„å ´åˆ
    If VarType(s) <> vbString Then
        Exit Function
    End If

    iLen = Len(s)

    ' æ–‡å­—åˆ—é•·ã‚ˆã‚ŠæŒ‡å®šæ–‡å­—æ•°ãŒå¤§ãã„å ´åˆ
    If iLen < i Then
        Exit Function
    End If

    ' æŒ‡å®šæ–‡å­—æ•°ã‚’å‰Šé™¤ã—ã¦è¿”ã™
    CutRight = Left(s, iLen - i)
End Function

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : å¯¾è±¡ã®ã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹åˆ¤å®š
' note  :
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Private Function SheetExists(sheetName As String) As Boolean

    Dim wb As Workbook
    Dim ws As Worksheet

    Set wb = ThisWorkbook

    On Error Resume Next
    Set ws = wb.Worksheets(sheetName)
    On Error GoTo 0

    SheetExists = Not ws Is Nothing

End Function

' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
' brief : ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
' note  :
' ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ---- ----
Private Sub KillFile(filePath As String)
    Dim strFilePath As String
    strFilePath = filePath 'ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

    If Dir(strFilePath) <> "" Then
        ' ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹
        Debug.Print "ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤é–‹å§‹ï¼š" & strFilePath
        Kill strFilePath
    Else
        ' ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
        Debug.Print "ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼š" & strFilePath
    End If

End Sub
```

Excelã®å„ã‚·ãƒ¼ãƒˆã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã—ã¦ä¿å­˜ã™ã‚‹ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªæ©Ÿèƒ½ã§ã™ãŒã€æ³¨æ„ã™ã¹ãç‚¹ã‚‚ã„ãã¤ã‹ã‚ã£ãŸè‰¯ã„ã‚µãƒ³ãƒ—ãƒ«ã§ã—ãŸã€‚

ä»Šå›ã®é–¢æ•°ã¯æ±ç”¨çš„ã«ã‚‚ä½¿ãˆã‚‹ãŸã‚ã€é–¢æ•°ã®ã‚¢ã‚¯ã‚»ã‚¹ä¿®é£¾å­ã‚’ private ã‹ã‚‰ public ã«å¤‰æ›´ã—ã¦æ´»ç”¨ã—ã¦ã‚‚ã‚‰ã£ã¦ã‚‚ã‚ˆã„ã‹ã¨æ€ã„ã¾ã™ã€‚

ä»¥ä¸Šã§ã™ã€‚
