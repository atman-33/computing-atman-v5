---
title: C# | WPF Prism ç”»é¢é·ç§»ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ãƒˆï¼‰
description: C# WPF Prism ãƒŠãƒ“ã‚²ãƒ¼ãƒˆç”»é¢ã®é·ç§»æ–¹æ³•
date: 2023-02-26
emoji: ğŸ¤–
tags: 
  - csharp
published: true
---

C#ã® **WPF Prism** ã§ãƒŠãƒ“ã‚²ãƒ¼ãƒˆç”»é¢ã®é·ç§»æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

ä¸‹è¨˜ã®ã‚ˆã†ã«ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ç”»é¢ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹å‡¦ç†ã§ã™ã€‚
ï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã¯ãªãã€ç”»é¢å†…ã®è¡¨ç¤ºãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚ï¼‰

![image](/blog/26/1.gif)

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹ï¼‰

ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸‹è¨˜ã® **Aï½C** ã§ã™ã€‚

```text
Views/
 |-MainWindowView.xamlï¼ˆç”»é¢é·ç§»å…ƒï¼‰ã€€ï½¥ï½¥ï½¥A
 |-SampleNavigationView.xaml(ç”»é¢é·ç§»å…ˆ)

ViewModels/
 |-MainWindowViewModel.csï¼ˆç”»é¢é·ç§»å…ƒï¼‰ã€€ï½¥ï½¥ï½¥B
 |-SampleNavigationViewModel.cs(ç”»é¢é·ç§»å…ˆ)ã€€ï½¥ï½¥ï½¥C

App.xaml.csã€€ï½¥ï½¥ï½¥D
```

## MainWindowView.xamlï¼ˆç”»é¢é·ç§»å…ƒï¼‰ã€€ï½¥ï½¥ï½¥A

### â‘ ãƒœã‚¿ãƒ³ã«Commandã‚’è¿½åŠ 

ç”»é¢é·ç§»å…ƒã®Viewã®ãƒœã‚¿ãƒ³ã«å¯¾ã—ã¦ã€Commandã«Bindingã§ãƒ‡ãƒªã‚²ãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰åç§°ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```xml
<Button Content="SampleãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢"
        FontSize="14"
        Margin="10"
        Padding="5"
        Command="{Binding SampleNavigationViewButton}"/>
```

## MainWindowViewModel.csï¼ˆç”»é¢é·ç§»å…ƒï¼‰ã€€ï½¥ï½¥ï½¥B

### â‘¡ViewModelã«IRegionManagerã®å¤‰æ•°ã‚’è¿½åŠ 

ç”»é¢é·ç§»å…ƒã®ViewModelã«ã€IRegionManagerã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå¤‰æ•°ã‚’è¿½åŠ ã—ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚

### â‘¢ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®å®Ÿè¡Œãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 

ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚‹ãƒ‡ãƒªã‚²ãƒ¼ãƒˆã‚³ãƒãƒ³ãƒ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®Excuteãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

â–¼ä¸Šè¨˜â‘¡ï½â‘¢ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
```cs
private IRegionManager _regionManager;  //// ç”»é¢é·ç§»ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

//// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
public MainWindowViewModel(IRegionManager regionManager)
{
    //// ç”»é¢é·ç§»ç”¨ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
    _regionManager = regionManager;

    SampleNavigationViewButton = new DelegateCommand(SampleNavigationViewButtonExecute);
}

public DelegateCommand SampleNavigationViewButton { get; }

private void SampleNavigationViewButtonExecute()
{
   //// ç”»é¢é·ç§»å‡¦ç†ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
   _regionManager.RequestNavigate("ContentRegion", nameof(SampleNavigationView));
}
```

## SampleNavigationViewModel.cs(ç”»é¢é·ç§»å…ˆ)ã€€ï½¥ï½¥ï½¥C

### â‘£INavigationAwareã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…
ç”»é¢é·ç§»å…ˆã®ViewModelã«ã€**INavigationAwareã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹** ã¨ **IRegionMemberLifetimeã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

â€»2023/3/5 è¿½è¨˜
ViewModelã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ãƒ¢ãƒªé–‹æ”¾ã®ãŸã‚ã€IRegionMemberLifetimeã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£…ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

### â‘¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´
INavigationAwareã‚’å®Ÿè£…ã—ãŸäº‹ã§è¿½åŠ ã•ã‚Œã‚‹ IsNavigationTarget ã® æˆ»ã‚Šå€¤ã‚’ true ã¨ã—ã€KeepAlive ã‚’ false ã«ã—ã¦ä¸‹ã•ã„ã€‚ãã†ã™ã‚Œã°ã€ç”»é¢ç ´æ£„ã§ãƒ¡ãƒ¢ãƒªãŒé–‹æ”¾ã•ã‚Œã¾ã™ã€‚

â–¼ä¸Šè¨˜â‘£ï½â‘¤ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
```cs
public class SampleTableEditViewModel : BindableBase, INavigationAware, IRegionMemberLifetime
{
    /// <summary>
    /// ViewModelç ´æ£„ã«ä¼´ã„ãƒ¡ãƒ¢ãƒªé–‹æ”¾ã™ã‚‹éš›ã¯false
    /// </summary>
    public bool KeepAlive { get; set; } = false;

    //// å„ç¨®å‡¦ç†

    public bool IsNavigationTarget(NavigationContext navigationContext)
    {
        //// RegionMemberLifetime(KeepAlive = false)ã§ViewModelã‚’ç ´æ£„ã™ã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã¯True
        return true;
    }

    public virtual void OnNavigatedFrom(NavigationContext navigationContext)
    {
    }

    public virtual void OnNavigatedTo(NavigationContext navigationContext)
    {
    }
}
```

## App.xaml.csã€€ï½¥ï½¥ï½¥D

### â‘¥RegisterTypeså†…ã§Viewã‚’ç™»éŒ²

```cs
protected override void RegisterTypes(IContainerRegistry containerRegistry)
{
    //// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢
    containerRegistry.RegisterForNavigation<SampleNavigationView>();
}
```

containerRegistry.RegisterForNavigationã«è¨­å®šã—ãŸViewãŒç”»é¢é·ç§»å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚
