---
title: C# WPFã§ObservableCollectionã‚’éåŒæœŸã§æ›´æ–°ã™ã‚‹æ–¹æ³•
description: WPFã§éåŒæœŸæ›´æ–°å¯èƒ½ãªObservableCollectionã‚’å®Ÿè£…ã€‚AsyncObservableCollectionã¨PageMstCollectionã®ä¾‹ã‚’ç´¹ä»‹
date: 2024-01-30
lastmod: 2024-01-30
emoji: ğŸ±
tags: 
  - csharp
published: true
---

WPFã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€UIã‚¹ãƒ¬ãƒƒãƒ‰ã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã®é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ãã®ãŸã‚ã€éåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€UIã«åæ˜ ã™ã‚‹ãŸã‚ã®ObservableCollectionã‚’å®Ÿè£…ã—ã¾ã™ã€‚  
ã“ã®è¨˜äº‹ã§ã¯ã€ãã®æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ObservableCollectionã®éåŒæœŸæ›´æ–°

WPFã§ã¯ã€UIã¸ã®å¤‰æ›´ã¯UIã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€éåŒæœŸå‡¦ç†ã‚’è¡Œã„ã¤ã¤UIã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã€`BindingOperations.EnableCollectionSynchronization`ã¨`lockæ–‡`ã‚’ä½¿ã†ã“ã¨ã§ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ã€‚

```csharp
public class PageMstCollection : ObservableCollection<PageMstViewModelEntity>
{
    private readonly object _lock = new object();
    private readonly IPageMstRepository _pageMstRepository;

    public PageMstCollection(IPageMstRepository pageMstRepository)
    {
        _pageMstRepository = pageMstRepository;
        BindingOperations.EnableCollectionSynchronization(this, _lock);
    }

    public async Task LoadDataAsync()
    {
        var newData = await Task.Run(() =>
        {
            return _pageMstRepository.GetData().Select(entity => new PageMstViewModelEntity(entity));
        });

        lock (_lock)
        {
            Clear();
            foreach (var item in newData)
            {
                Add(item);
            }
        }
    }
}
```

ã“ã®ã‚¯ãƒ©ã‚¹ã§ã¯ã€`LoadDataAsync`ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§`_pageMstRepository`ã‹ã‚‰éåŒæœŸã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€`lock`æ–‡ã‚’ä½¿ç”¨ã—ã¦UIã‚¹ãƒ¬ãƒƒãƒ‰ã§å®‰å…¨ã«`ObservableCollection`ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

## ViewModelã®ä½¿ç”¨ä¾‹

æœ€å¾Œã«ã€ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã‚’ViewModelã§ä½¿ç”¨ã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```csharp
public class MainViewModel : ViewModelBase
{
    private readonly PageMstCollection _pageMstCollection;

    public MainViewModel(IPageMstRepository pageMstRepository)
    {
        _pageMstCollection = new PageMstCollection(pageMstRepository);
        LoadData();
    }

    private async void LoadData()
    {
        await _pageMstCollection.LoadDataAsync();
        OnPropertyChanged(nameof(PageMstCollection));
    }

    public ObservableCollection<PageMstViewModelEntity> PageMstCollection => _pageMstCollection;
}
```

ViewModelã§`LoadDataAsync`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã«èª­ã¿è¾¼ã¿ã€UIã«åæ˜ ã§ãã¾ã™ã€‚`OnPropertyChanged`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€`PageMstCollection`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´ã‚’é€šçŸ¥ã—ã¾ã™ã€‚

ã“ã‚Œã§ã€éåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ObservableCollectionã‚’ä½œæˆã—ã€WPFã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã™ã‚‹æ–¹æ³•ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚