---
title: Turborepo NestJS ã‹ã‚‰å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‚ç…§ã§ããªã„å•é¡Œã®å¯¾å‡¦æ–¹æ³•
description: Turborepo NestJSã‹ã‚‰å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆPrismaç­‰ï¼‰ã‚’å‚ç…§ã§ããªã„å ´åˆã®å¯¾å‡¦æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚
date: 2024-05-05
lastmod: 2024-05-05
emoji: ğŸº
tags: 
  - turborepo
published: true
---

Turborepo ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã€Next.jsãªã©ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€transpilePackages æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã—ã¦å•é¡Œç„¡ãå†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  

ä¸€æ–¹ã€NestJS ãªã©ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãã®ã¾ã¾å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

e.g. error  

```bash
"C:\Program Files\nodejs\npm.cmd" run start

> nest@0.0.1 start
> nest start               

Error: Cannot find module '@repo/database'
Require stack:
```

ã“ã®å•é¡Œã¯ã€å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’JavaScriptã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚Œã°å›é¿å¯èƒ½ã§ã™ã€‚

## å¯¾å‡¦æ–¹æ³•

### 1. å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«`tsup`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm i -D tsup -w <workspace>
```

e.g. `data-access-db`ã¨ã„ã†å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å ´åˆï¼ˆPrismaClient ã‚’åˆ©ç”¨ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãªã©ã‚’æƒ³å®šï¼‰  

```bash
npm i -D tsup -w packages/data-access-db
```

### 2. å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`package.json`ã‚’å¤‰æ›´

buildã‚³ãƒãƒ³ãƒ‰ã§ã€distãƒ•ã‚©ãƒ«ãƒ€ã«jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚  

`package.json`

```json
  "main": "./dist/index.js",
  "module": "./dist/index.mjs",
  "types": "./dist/index.d.ts",
  "scripts": {
    "build": "tsup src/index.ts --format cjs,esm --dts",
    "dev": "npm run build -- --watch"
  },
```

### 3. NestJSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èµ·å‹•ã™ã‚‹å‰ã«ãƒ“ãƒ«ãƒ‰ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm run build -w <workspace>
npm i
```

e.g.  

```bash
npm run build -w packages/data-access-db
```

æ¯å›NestJSã‚’ç«‹ã¡ä¸Šã’ã‚‹éš›ã«å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã®ã¯æ‰‹é–“ãªãŸã‚ã€ãƒˆãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®`package.json`ã«ã€å†…éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦NestJSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æº–å‚™ã—ã¦ãŠãã¨è‰¯ã„ã§ã™ã€‚
