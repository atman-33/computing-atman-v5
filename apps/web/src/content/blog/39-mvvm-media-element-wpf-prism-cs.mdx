---
title: C# | WPF Prism å‹•ç”»ï¼ˆMediaElementï¼‰ã‚’MVVMãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã‚‹æ–¹æ³•
description: WPF Prism ã®å‹•ç”»å†ç”Ÿï¼ˆMediaElement.Play()ï¼‰ã‚’ã€MVVM ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã‚‹æ–¹æ³•
date: 2023-03-19
emoji: ğŸ¡
tags: 
  - csharp
published: true
---

WPF Prism ã®å‹•ç”»å†ç”Ÿï¼ˆMediaElement.Play()ï¼‰ã‚’ã€MVVM ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### IMediaService ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

1. IMediaService ã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’å°å…¥ã—ã¾ã™ã€‚

```cs
public Interface IMediaService
{
    void Play();
    void Pause();
    void Stop();
    void Rewind();
    void FastForward();
    bool IsPlaying();
}
```

### View ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰

2. ãƒ“ãƒ¥ãƒ¼ã« IMediaService ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```cs
public partial class DemoView : UserControl, IMediaService
{
    public DemoView()
    {
        InitializeComponent();
    }

    void IMediaService.FastForward()
    {
        this.MediaPlayer.Position += TimeSpan.FromSeconds(10);
    }

    void IMediaService.Pause()
    {
        this.MediaPlayer.Pause();
    }

    void IMediaService.Play()
    {
        this.MediaPlayer.Play();
    }

    void IMediaService.Rewind()
    {
        this.MediaPlayer.Position -= TimeSpan.FromSeconds(10);
    }

    void IMediaService.Stop()
    {
        this.MediaPlayer.Stop();
    }

    bool IMediaService.IsPlaying()
    {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†æ™‚ã¯true
        return this.MediaPlayer.Position < this.MediaPlayer.NaturalDuration;
    }
}
```

### View Xaml

3. æ¬¡ã«ã€DemoView.XAML ã«ã„ãã¤ã‹ã®ã‚³ãƒ¼ãƒ‰ã‚’åŠ ãˆã¾ã™ã€‚

- MediaElement ã«åå‰ã‚’ä»˜ã‘ã¦ã€ã‚³ãƒ¼ãƒ‰ ãƒ“ãƒã‚¤ãƒ³ãƒ‰ãŒä¸Šè¨˜ã®ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  
   `<MediaElement Source="{Binding CurrentMedia}" x:Name="MediaPlayer"/>`

- ãƒ“ãƒ¥ãƒ¼ã«åå‰ã‚’ä»˜ã‘ã¦ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªåå‰ç©ºé–“ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãŠãã¾ã™ã€‚ï¼ˆä»–ã«ã‚‚å¿…è¦ãªåå‰ç©ºé–“ã¯çœç•¥ï¼‰

```xml
   <UserControl x:Class="Test.DemoView"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
     x:Name="MediaService">
```

- ãƒˆãƒªã‚¬ãƒ¼ã‚’ä»‹ã—ã¦ Loaded ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¥ç¶šã—ã€ã‚³ãƒãƒ³ãƒ‰ã‚’ä»‹ã—ã¦ãƒ“ãƒ¥ãƒ¼è‡ªä½“ï¼ˆx:Name=MediaServiceï¼‰ã‚’ãƒ“ãƒ¥ãƒ¼ ãƒ¢ãƒ‡ãƒ«ã«æ¸¡ã—ã¾ã™ã€‚

```xml
   <i:Interaction.Triggers>
         <i:EventTrigger EventName="Loaded">
             <i:InvokeCommandAction Command="{Binding MediaServiceLoaded}" CommandParameter="{Binding ElementName=MediaService}"></i:InvokeCommandAction>
         </i:EventTrigger>
     </i:Interaction.Triggers>
```
- MediaElement ã‚’æ“ä½œã™ã‚‹ãƒœã‚¿ãƒ³ï¼ˆã‚³ãƒãƒ³ãƒ‰ï¼‰ã‚’æº–å‚™ã—ã¦ãŠãã¾ã™ã€‚
```xml
   <Button Command="{Binding MoviePlayButton}" Content="Play"></Button> 
   <Button Command="{Binding MovieStopButton}" Content="Stop"></Button> 
```

### ViewModel

4. ViewModel ã§ MediaElement ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```cs
public class DemoViewModel : BindableBase
{
    public DemoViewModel()
    {
        MediaServiceLoaded = new DelegateCommand<IMediaService>(MediaServiceLoadedExecute);
        MoviePlayButton = new DelegateCommand(MoviePlayButtonExecute);

        // ...
    }

    public IMediaService MediaService {get; private set;}

    public DelegateCommand<IMediaService> MediaServiceLoaded { get; }
    private void MediaServiceLoadedExecute(IMediaService mediaService)
    {
        this.MediaService = mediaService;
    }

    public DelegateCommand MoviePlayButton { get; }
    private void MoviePlayButtonExecute()
    {
        if (MediaService == null)
        {
            return;
        }

        MediaService.Play();
    }

    // ...
}
```

ã“ã‚Œã‚‰ã®æ‰‹é †ã«å¾“ã†ã“ã¨ã§ã€ViewModelå†…ã§MediaElementã‚’å†ç”ŸãŠã‚ˆã³åœæ­¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
å°‘ã€…ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€MVVMãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å®ˆã‚‰ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚